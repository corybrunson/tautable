StatAlluvium <- ggproto(
"StatAlluvium", Stat,
# frequency
required_aes = c("freq"),
# add axis-specific y0 and y1 params
setup_data = function(self, data, params) {
# aggregate freq over axes and panels
data <- aggregate(
formula = as.formula(paste("freq ~",
paste(setdiff(names(data), "freq"),
collapse = "+"))),
data = data, FUN = sum
)
# identify axes (in numerical order)
axis_ind <- grep("^axis[0-9\\.]*$", names(data))
axis_ind <- axis_ind[order(as.numeric(gsub("^axis", "",
names(data)[axis_ind])))]
# vertical floors at each axis, by panel
# (might want to parametrize the option to "hide" rather than "collapse"
# but not sure if anyone would ever use the former option)
if (FALSE) {
# hide version
alluvium_data <- as.data.frame(
do.call(rbind, lapply(1:length(axis_ind), function(i) {
# order axis indices
axis_seq <- axis_ind[zigzag(n = length(axis_ind), i = i)]
# order ribbons according to axes, in above order
ribbon_seq <- do.call(order, data[axis_seq])
# ribbon increments along axis
incrs <- c(0, cumsum(data$freq[ribbon_seq]))
# ribbon breaks in original order (omits last)
cbind(i, incrs[order(ribbon_seq)])
}))
)
# axis column name
names(alluvium_data) <- c("pos", "y0")
# combine with original data
res_data <- data.frame(data, alluvium_data)
} else {
# collapse version
res_data <- do.call(rbind, lapply(unique(data$PANEL), function(p) {
p_data <- subset(data, PANEL == p)
rownames(p_data) <- NULL
p_all <- do.call(rbind, lapply(1:length(axis_ind), function(i) {
# order axis indices
axis_seq <- axis_ind[zigzag(n = length(axis_ind), i = i)]
# order ribbons according to axes, in above order
ribbon_seq <- do.call(order, p_data[axis_seq])
# ribbon increments along axis
incrs <- c(0, cumsum(p_data$freq[ribbon_seq]))
# ribbon breaks in original order (omits last)
cbind(i, incrs[order(ribbon_seq)])
}))
# axis column name
colnames(p_all) <- c("pos", "y0")
# combine with original data
data.frame(p_data, p_all)
}))
}
print(res_data)
res_data
},
# calculate coordinates governing ribbon segments
compute_group = function(data, scales, params,
# axes to be placed at positive integers
axis_width = 1/3, ribbon_bend = 1/6) {
first_row <- data[1, setdiff(names(data), c("pos", "y0")),
drop = FALSE]
rownames(first_row) <- NULL
# spline coordinates (one axis)
if (nrow(data) == 1) {
spline_data <- data.frame(
x = data$pos + axis_width / 2 * c(-1, 1, 1, -1),
y = data$y0 + first_row$freq * c(0, 0, 1, 1),
shape = rep(0, 4)
)
return(data.frame(first_row, spline_data))
}
# spline coordinates (more than one axis)
x_oneway <- rep(data$pos, c(3, rep(4, nrow(data) - 2), 3)) +
axis_width / 2 * c(-1, rep(c(1, 1, -1, -1), nrow(data) - 1), 1) +
ribbon_bend * c(0, rep(c(0, 1, -1, 0), nrow(data) - 1), 0)
y_oneway <- rep(data$y0, c(3, rep(4, nrow(data) - 2), 3))
shape_oneway <- c(0, rep(c(0, 1, 1, 0), nrow(data) - 1), 0)
spline_data <- data.frame(
x = c(x_oneway, rev(x_oneway)),
y = c(y_oneway, rev(y_oneway) + first_row$freq),
shape = rep(shape_oneway, 2)
)
data.frame(first_row, spline_data)
}
)
stat_alluvium <- function(mapping = NULL, data = NULL, geom = "alluvium",
position = "identity", na.rm = FALSE, show.legend = NA,
inherit.aes = TRUE, ...) {
layer(
stat = StatAlluvium, data = data, mapping = mapping, geom = geom,
position = position, show.legend = show.legend,
inherit.aes = inherit.aes,
params = list(na.rm = na.rm, ...)
)
}
GeomAlluvium <- ggproto(
"GeomAlluvium", Geom,
required_aes = c("freq"),
default_aes = aes(size = .5, linetype = 1,
colour = 0, fill = "gray", alpha = .5),
draw_group = function(data, panel_scales, coord) {
coords <- coord$transform(data, panel_scales)
grid::xsplineGrob(
x = coords$x, y = coords$y, shape = coords$shape,
open = FALSE,
gp = grid::gpar(
col = coords$colour, fill = coords$fill, alpha = coords$alpha,
lty = coords$linetype, lwd = coords$size * .pt
)
)
},
draw_key = draw_key_polygon
)
geom_alluvium <- function(mapping = NULL, data = NULL, stat = "alluvium",
na.rm = FALSE, show.legend = NA, inherit.aes = TRUE,
...) {
layer(
geom = GeomAlluvium, mapping = mapping, data = data, stat = stat,
position = "identity", show.legend = show.legend,
inherit.aes = inherit.aes,
params = list(na.rm = na.rm, ...)
)
}
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium() +
geom_text(stat = "stratum")
# combining flows and boxes and using facets
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() +
facet_wrap(~ Survived, scales = "free_y")
#' Alluvial diagram
StatAlluvium <- ggproto(
"StatAlluvium", Stat,
# frequency
required_aes = c("freq"),
# add axis-specific y0 and y1 params
setup_data = function(self, data, params) {
# aggregate freq over axes and panels
data <- aggregate(
formula = as.formula(paste("freq ~",
paste(setdiff(names(data), "freq"),
collapse = "+"))),
data = data, FUN = sum
)
# identify axes (in numerical order)
axis_ind <- grep("^axis[0-9\\.]*$", names(data))
axis_ind <- axis_ind[order(as.numeric(gsub("^axis", "",
names(data)[axis_ind])))]
# vertical floors at each axis, by panel
# (might want to parametrize the option to "hide" rather than "collapse"
# but not sure if anyone would ever use the former option)
if (FALSE) {
# hide version
alluvium_data <- as.data.frame(
do.call(rbind, lapply(1:length(axis_ind), function(i) {
# order axis indices
axis_seq <- axis_ind[zigzag(n = length(axis_ind), i = i)]
# order ribbons according to axes, in above order
ribbon_seq <- do.call(order, data[axis_seq])
# ribbon increments along axis
incrs <- c(0, cumsum(data$freq[ribbon_seq]))
# ribbon breaks in original order (omits last)
cbind(i, incrs[order(ribbon_seq)])
}))
)
# axis column name
names(alluvium_data) <- c("pos", "y0")
# combine with original data
res_data <- data.frame(data, alluvium_data)
} else {
# collapse version
res_data <- do.call(rbind, lapply(unique(data$PANEL), function(p) {
p_data <- subset(data, PANEL == p)
rownames(p_data) <- NULL
p_all <- do.call(rbind, lapply(1:length(axis_ind), function(i) {
# order axis indices
axis_seq <- axis_ind[zigzag(n = length(axis_ind), i = i)]
# order ribbons according to axes, in above order
ribbon_seq <- do.call(order, p_data[axis_seq])
# ribbon increments along axis
incrs <- c(0, cumsum(p_data$freq[ribbon_seq]))
# ribbon breaks in original order (omits last)
cbind(i, incrs[order(ribbon_seq)])
}))
# axis column name
colnames(p_all) <- c("pos", "y0")
# combine with original data
data.frame(p_data, p_all)
}))
}
res_data
},
# calculate coordinates governing ribbon segments
compute_group = function(data, scales, params,
# axes to be placed at positive integers
axis_width = 1/3, ribbon_bend = 1/6) {
first_row <- data[1, setdiff(names(data), c("pos", "y0")),
drop = FALSE]
rownames(first_row) <- NULL
# spline coordinates (one axis)
if (nrow(data) == 1) {
spline_data <- data.frame(
x = data$pos + axis_width / 2 * c(-1, 1, 1, -1),
y = data$y0 + first_row$freq * c(0, 0, 1, 1),
shape = rep(0, 4)
)
return(data.frame(first_row, spline_data))
}
# spline coordinates (more than one axis)
x_oneway <- rep(data$pos, c(3, rep(4, nrow(data) - 2), 3)) +
axis_width / 2 * c(-1, rep(c(1, 1, -1, -1), nrow(data) - 1), 1) +
ribbon_bend * c(0, rep(c(0, 1, -1, 0), nrow(data) - 1), 0)
y_oneway <- rep(data$y0, c(3, rep(4, nrow(data) - 2), 3))
shape_oneway <- c(0, rep(c(0, 1, 1, 0), nrow(data) - 1), 0)
spline_data <- data.frame(
x = c(x_oneway, rev(x_oneway)),
y = c(y_oneway, rev(y_oneway) + first_row$freq),
shape = rep(shape_oneway, 2)
)
data.frame(first_row, spline_data)
}
)
stat_alluvium <- function(mapping = NULL, data = NULL, geom = "alluvium",
position = "identity", na.rm = FALSE, show.legend = NA,
inherit.aes = TRUE, ...) {
layer(
stat = StatAlluvium, data = data, mapping = mapping, geom = geom,
position = position, show.legend = show.legend,
inherit.aes = inherit.aes,
params = list(na.rm = na.rm, ...)
)
}
GeomAlluvium <- ggproto(
"GeomAlluvium", Geom,
required_aes = c("freq"),
default_aes = aes(size = .5, linetype = 1,
colour = 0, fill = "gray", alpha = .5),
draw_group = function(data, panel_scales, coord) {
coords <- coord$transform(data, panel_scales)
grid::xsplineGrob(
x = coords$x, y = coords$y, shape = coords$shape,
open = FALSE,
gp = grid::gpar(
col = coords$colour, fill = coords$fill, alpha = coords$alpha,
lty = coords$linetype, lwd = coords$size * .pt
)
)
},
draw_key = draw_key_polygon
)
geom_alluvium <- function(mapping = NULL, data = NULL, stat = "alluvium",
na.rm = FALSE, show.legend = NA, inherit.aes = TRUE,
...) {
layer(
geom = GeomAlluvium, mapping = mapping, data = data, stat = stat,
position = "identity", show.legend = show.legend,
inherit.aes = inherit.aes,
params = list(na.rm = na.rm, ...)
)
}
# combining flows and boxes and using facets
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() +
facet_wrap(~ Survived, scales = "free_y")
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() + geom_text(stat = "stratum") +
facet_wrap(~ Survived, scales = "free_y")
GeomRect$draw_panel
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium() +
geom_text(stat = "stratum") +
ggtitle("Alluvial diagram of Titanic passenger data")
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium() +
geom_text(stat = "stratum") +
ggtitle("Alluvial diagram of Titanic passenger demographic data")
# use of aesthetics
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium(aes(fill = Age, alpha = Sex, color = Survived)) +
scale_color_manual(values = c("black", "white"))
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age, alpha = Sex, color = Survived)) +
scale_color_manual(values = c("black", "white"))
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium() +
geom_text(stat = "stratum")
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium() +
geom_text(stat = "stratum") +
ggtitle("Titanic passenger demographic and survival data")
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium() +
geom_text(stat = "stratum") +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium() +
geom_stratum() +
geom_text(stat = "stratum") +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age, alpha = Sex, color = Survived) +
geom_text(stat = "stratum") +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age, alpha = Sex, color = Survived)) +
geom_text(stat = "stratum") +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age, alpha = Sex, color = Survived)) +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age, alpha = Sex, color = Survived)) +
scale_color_manual(values = c("black", "white")) +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age*Sex, alpha = Class, color = Survived)) +
scale_color_manual(values = c("black", "white")) +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age)) +
geom_alluvium(aes(fill = Age:Sex, alpha = Class, color = Survived)) +
scale_color_manual(values = c("black", "white")) +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
# combining flows and boxes and using facets
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() +
facet_wrap(~ Survived, scales = "free_y")
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Survived)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() +
facet_wrap(~ Survived, scales = "free_y")
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Survived)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() + geom_text(stat = "stratum") +
facet_wrap(~ Survived, scales = "free_y")
ggplot(as.data.frame(Titanic),
aes(freq = Freq, axis1 = Class, axis2 = Sex)) +
geom_alluvium(aes(fill = Age)) +
geom_stratum() + geom_text(stat = "stratum") +
facet_wrap(~ Survived, scales = "free_y")
is.array(Titanic)
is.numeric(Titanic)
as.data.frame(Titanic)
ggplot
library(ggplot)
library(ggplot2)
ggplot
library(devtools)
install_github("corybrunson/ggalluvial")
library(ggalluvial)
ggplot(as.data.frame(Titanic),
aes(freq = Freq,
axis1 = Class, axis2 = Sex, axis3 = Age, axis4 = Survived)) +
geom_alluvium() +
geom_stratum() +
geom_text(stat = "stratum") +
ggtitle("Titanic passenger demographic and survival data") +
theme_bw()
devtools::load_all("corybrunson/ggalluvial")
library(ggalluvial)
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + geom_alluvial()
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + geom_alluvium()
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + geom_alluvium(stat = "identity")
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + stat_alluvium()
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + stat_alluvium(geom = "point")
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + stat_alluvium(geom = "lines")
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex, axis3 = Age)) + stat_alluvium(geom = "line")
ggplot(as.data.frame(Titanic), aes(freq = Freq, axis1 = Class, axis2 = Sex)) + stat_alluvium(geom = "line")
data <- as.data.frame(Titanic)
head(data)
names(data) <- c("axis1", "axis2", "axis3", "axis4", "freq")
data$PANEL <- 1
data$group <- as.numeric(data$Class:data$Sex:data$Age:data$Survived)
data$group <- as.numeric((data$Class):(data$Sex):(data$Age):(data$Survived))
data$group <- as.numeric((data$axis1):(data$axis2):(data$axis3):(data$axis4))
data
layer(stat = StatStratum, data = data)
StatStratum
StatStratum(data)
library(ggplot2)
GeomBar
number_of_teams<-5
number_of_games<-8
input_matrix<-matrix(0,number_of_games,2)
input_matrix
input_matrix[1, ] <- c(1,3)
input_matrix[2, ] <- c(1,5)
input_matrix[3, ] <- c(2,1)
input_matrix[4, ] <- c(2,5)
input_matrix[5, ] <- c(3,4)
input_matrix[6, ] <- c(3,5)
input_matrix[7, ] <- c(4,5)
input_matrix[8, ] <- c(4,5)
input_matrix
data_matrix <- matrix(0,
(number_of_games + 2 * number_of_teams),
number_of_teams)
data_matrix
for (i in 1:number_of_games) {
data_matrix[i, input_matrix[i, 1]] <- 1
data_matrix[i, input_matrix[i, 2]] <- (-1)
}
data_matrix
for (i in 1:(number_of_teams)) {
#every team beats the virtual team exactly once
data_matrix[(number_of_games + i), i] <- 1
#every team losses to the virtual team exactly once
data_matrix[(number_of_games + number_of_teams + i), i] <- (-1)
}
data_matrix
rep(1, (number_of_games + 2 * number_of_teams))
data_matrix - 1
model <- glm(rep(1, (number_of_games + 2 * number_of_teams)) ~
data_matrix - 1,
family = binomial(link = probit))
summary(model)
library(igraph)
g <- graph_from_edgelist(input_matrix)
g
plot(g)
data_matrix
?evcent
eigen_centrality(g, directed = TRUE)
eigen_centrality(g, directed = TRUE)$vector
eigen_centrality(g, directed = TRUE)$value
model2 <- glm(rep(1, (number_of_games + 2 * number_of_teams)) ~
data_matrix - 1,
family = binomial(link = logit))
summary(model2)
hist(coef(model)[, "Estimate"])
hist(coef(model)[, "Estimate", drop = TRUE])
coef(model)
hist(coef(model))
hist(coef(model2))
library(ggplot2)
coef_dat <- data.frame(model = rep(1:2, each = 5), coef = c(coef(model), coef(model2)))
ggplot(data=coef_dat,aes(x=coef))+geom_bar()
ggplot(data=coef_dat,aes(x=coef))+geom_bar()+facet_wrap(~model)
ggplot(data=coef_dat,aes(x=coef))+geom_histogram()+facet_wrap(~model)
ggplot(data=coef_dat,aes(x=coef))+geom_histogram()+facet_grid(~model)
ggplot(data=coef_dat,aes(x=coef))+geom_histogram()+facet_grid(model~.)
coef_dat <- data.frame(model = rep(1:2, each = 5),
coef = c(coef(model), coef(model2)))
ggplot(data = coef_dat, aes(x = coef)) +
geom_histogram() +
facet_grid(model ~ .)
setwd("Documents/edu/R/tautable")
check()
library(devtools)
check()
install()
vignette(package="tautable")
check()
build()
install()
vignette(package="tautable")
vignette()
